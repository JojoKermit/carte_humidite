<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Carte Humidité du Sol</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    #canvas {
      border: 1px solid #333;
      cursor: crosshair;
    }
    #tooltip {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid #444;
      padding: 6px 10px;
      font-size: 14px;
      pointer-events: none;
      display: none;
      border-radius: 4px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <h1>Carte d'humidité du sol - 01/09/2025</h1>
  <canvas id="canvas" width="1013" height="1052"></canvas>
  <div id="tooltip"></div>

  <script>
    const colorMap = [
      { r: 200, g: 0, b: 0, value: "< 5%" },
      { r: 212, g: 32, b: 19, value: "5-10%" },
      { r: 224, g: 66, b: 38, value: "10-15%" },
      { r: 236, g: 102, b: 62, value: "15-20%" },
      { r: 250, g: 135, b: 82, value: "20-25%" },
      { r: 252, g: 160, b: 93, value: "25-30%" },
      { r: 255, g: 188, b: 107, value: "30-35%" },
      { r: 255, g: 213, b: 122, value: "35-40%" },
      { r: 252, g: 234, b: 131, value: "40-45%" },
      { r: 245, g: 250, b: 140, value: "45-50%" },
      { r: 221, g: 250, b: 145, value: "50-55%" },
      { r: 205, g: 240, b: 145, value: "55-60%" },
      { r: 185, g: 230, b: 145, value: "60-65%" },
      { r: 160, g: 220, b: 155, value: "65-70%" },
      { r: 140, g: 210, b: 180, value: "70-75%" },
      { r: 120, g: 190, b: 195, value: "75-80%" },
      { r: 95, g: 165, b: 200, value: "80-85%" },
      { r: 70, g: 140, b: 200, value: "85-90%" },
      { r: 55, g: 120, b: 205, value: "90-95%" },
      { r: 55, g: 105, b: 210, value: ">95%" }
    ];

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const tooltip = document.getElementById("tooltip");

    const img = new Image();
    img.src = "Humidite_Sol_01092025.png";

    img.onload = () => {
      ctx.drawImage(img, 0, 0);
    };

    img.onerror = () => {
      alert("Erreur de chargement de l'image !");
    };

    canvas.addEventListener("mousemove", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor(e.clientX - rect.left);
      const y = Math.floor(e.clientY - rect.top);

      const pixel = ctx.getImageData(x, y, 1, 1).data;
      const [r, g, b] = [pixel[0], pixel[1], pixel[2]];
      const humidity = getApproximateColorValue(r, g, b);

      tooltip.style.left = `${e.pageX + 10}px`;
      tooltip.style.top = `${e.pageY + 10}px`;
      tooltip.innerHTML = `
        <strong>Humidité</strong>: ${humidity}
      `;
      tooltip.style.display = "block";
    });

    canvas.addEventListener("mouseleave", () => {
      tooltip.style.display = "none";
    });

  function getApproximateColorValue(r, g, b) {
  let closest = null;
  let minDistance = Infinity;

  for (const c of colorMap) {
    const distance = Math.sqrt(
      (c.r - r) ** 2 +
      (c.g - g) ** 2 +
      (c.b - b) ** 2
    );

    if (distance < minDistance) {
      minDistance = distance;
      closest = c;
    }
  }

  return minDistance <= 20 ? closest.value : `Valeur inconnue (RGB ${r}, ${g}, ${b})`;
}
  </script>
</body>
</html>
